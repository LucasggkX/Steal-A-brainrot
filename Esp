local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
loadstring(game:HttpGet("https://raw.githubusercontent.com/LucasggkX/Steal-A-brainrot/refs/heads/main/Brain%20list%20esp.lua"))()
local ESPMap = {}
local PlayerConns = {}
local BaseESPMap = {}

_G.God = false
_G.Secret = false
_G.PlayerESP = false
_G.BaseESP = false

local function destroyESP(obj)
    local t = ESPMap[obj]; if not t then return end
    if t.conns then for _,c in ipairs(t.conns) do pcall(function() c:Disconnect() end) end end
    if t.highlight then pcall(function() t.highlight:Destroy() end) end
    if t.billboard then pcall(function() t.billboard:Destroy() end) end
    ESPMap[obj] = nil
end

local function createESP(obj, category, color, label)
    if not obj or ESPMap[obj] or not obj:IsDescendantOf(workspace) then return end
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_Highlight"
    highlight.Adornee = obj
    highlight.FillColor = color
    highlight.FillTransparency = 0.5
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.Parent = obj
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP_Billboard"
    billboard.Size = UDim2.new(0, 120, 0, 28)
    billboard.AlwaysOnTop = true
    billboard.Adornee = obj
    billboard.Parent = obj
    local tl = Instance.new("TextLabel")
    tl.Size = UDim2.fromScale(1,1)
    tl.BackgroundTransparency = 1
    tl.TextColor3 = Color3.fromRGB(255,255,255)
    tl.TextStrokeTransparency = 0
    tl.TextScaled = true
    tl.Font = Enum.Font.GothamBold
    tl.Text = label
    tl.Parent = billboard
    local conns = {}
    conns[#conns+1] = obj.AncestryChanged:Connect(function(_, parent)
        if not parent then destroyESP(obj) end
    end)
    ESPMap[obj] = {category = category, highlight = highlight, billboard = billboard, conns = conns}
end

local function scanNamesFor(setTable, category, color)
    for _, inst in ipairs(workspace:GetDescendants()) do
        if setTable[inst.Name] then
            createESP(inst, category, color, inst.Name)
        end
    end
end

local function removeCategory(cat)
    for obj, t in pairs(ESPMap) do
        if t.category == cat then destroyESP(obj) end
    end
end

local function addCharacterESP(character, name)
    if not character then return end
    createESP(character, "player", Color3.fromRGB(0,255,0), name)
end

local function watchPlayer(plr)
    if PlayerConns[plr] then return end
    PlayerConns[plr] = {}
    PlayerConns[plr][#PlayerConns[plr]+1] = plr.CharacterAdded:Connect(function(char)
        if _G.PlayerESP then
            addCharacterESP(char, plr.Name)
        end
    end)
    if plr.Character and _G.PlayerESP then
        addCharacterESP(plr.Character, plr.Name)
    end
end

local function unwatchPlayers()
    for plr, conns in pairs(PlayerConns) do
        for _,c in ipairs(conns) do pcall(function() c:Disconnect() end) end
        PlayerConns[plr] = nil
    end
    removeCategory("player")
end

local descAddedConn = workspace.DescendantAdded:Connect(function(inst)
    if _G.God and _G.godsSet[inst.Name] then
        createESP(inst, "god", Color3.fromRGB(255,0,0), inst.Name)
    end
    if _G.Secret and _G.secretsSet[inst.Name] then
        createESP(inst, "secret", Color3.fromRGB(0,128,255), inst.Name)
    end
end)

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESPs"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 200)
frame.Position = UDim2.new(0, 50, 0, 50)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active, frame.Draggable = true, true
frame.Parent = screenGui

local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(50,50,50)
titleBar.Parent = frame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -30, 1, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "ESPs"
titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
titleLabel.TextSize = 20
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 1, 0)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(200,50,50)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255,255,255)
closeButton.TextSize = 18
closeButton.Parent = titleBar

local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1,0,1,-30)
contentFrame.Position = UDim2.new(0,0,0,30)
contentFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
contentFrame.Parent = frame

local function makeButton(text, y)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(1,0,0,40)
    b.Position = UDim2.new(0,0,0,y)
    b.Text = text
    b.TextColor3 = Color3.fromRGB(255,255,255)
    b.BackgroundColor3 = Color3.fromRGB(60,60,60)
    b.Parent = contentFrame
    return b
end

local function setBtnState(btn, active)
    btn.BackgroundColor3 = active and Color3.fromRGB(30,140,60) or Color3.fromRGB(60,60,60)
end

local secretButton = makeButton("Secret (toggle)", 0)
local godButton = makeButton("God (toggle)", 40)
local playerButton = makeButton("Player ESP (toggle)", 80)
local baseButton = makeButton("Base ESP (toggle)", 120)

secretButton.MouseButton1Click:Connect(function()
    _G.Secret = not _G.Secret
    setBtnState(secretButton,_G.Secret)
    if _G.Secret then scanNamesFor(_G.secretsSet,"secret",Color3.fromRGB(0,128,255)) else removeCategory("secret") end
end)

godButton.MouseButton1Click:Connect(function()
    _G.God = not _G.God
    setBtnState(godButton,_G.God)
    if _G.God then scanNamesFor(_G.godsSet,"god",Color3.fromRGB(255,0,0)) else removeCategory("god") end
end)

playerButton.MouseButton1Click:Connect(function()
    _G.PlayerESP = not _G.PlayerESP
    setBtnState(playerButton,_G.PlayerESP)
    if _G.PlayerESP then
        for _,plr in ipairs(Players:GetPlayers()) do
            if plr~=LocalPlayer then watchPlayer(plr) end
        end
        Players.PlayerAdded:Connect(function(plr)
            if plr~=LocalPlayer and _G.PlayerESP then watchPlayer(plr) end
        end)
    else unwatchPlayers() end
end)

baseButton.MouseButton1Click:Connect(function()
    _G.BaseESP = not _G.BaseESP
    setBtnState(baseButton,_G.BaseESP)
end)

closeButton.MouseButton1Click:Connect(function()
    _G.God,_G.Secret,_G.PlayerESP,_G.BaseESP=false,false,false,false
    for obj in pairs(ESPMap) do destroyESP(obj) end
    for _,v in pairs(BaseESPMap) do if v.gui then v.gui:Destroy() end end
    BaseESPMap = {}
    unwatchPlayers()
    screenGui:Destroy()
end)

local function createBillboard(parent,color)
    local bb = Instance.new("BillboardGui")
    bb.Adornee = parent
    bb.Size = UDim2.new(0,200,0,50)
    bb.StudsOffset = Vector3.new(0,4,0)
    bb.AlwaysOnTop = true
    bb.Parent = parent
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextColor3 = color
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.Parent = bb
    return bb,label
end

local function createBaseESP(plot)
    if BaseESPMap[plot] then return end
    local sign = plot:FindFirstChild("PlotSign")
    if not sign then return end
    local textLabel = sign:FindFirstChildWhichIsA("SurfaceGui")
        and sign.SurfaceGui:FindFirstChild("Frame")
        and sign.SurfaceGui.Frame:FindFirstChild("TextLabel")
    if textLabel and textLabel.Text=="Empty Base" then return end
    local block = plot.Purchases.PlotBlock.Main
    local bb,label = createBillboard(block,Color3.fromRGB(255,255,255))
    BaseESPMap[plot] = { gui=bb,label=label }
end

local function updateBaseESP()
    for _,plot in pairs(workspace.Plots:GetChildren()) do
        if plot:FindFirstChild("Purchases") then
            createBaseESP(plot)
            local data=BaseESPMap[plot]
            if data then
                local block=plot.Purchases.PlotBlock.Main
                local lockedText=block:FindFirstChild("BillboardGui") and block.BillboardGui:FindFirstChild("Locked")
                local remainText=block:FindFirstChild("BillboardGui") and block.BillboardGui:FindFirstChild("RemainingTime")
                if lockedText and lockedText.Text=="Locked:" then
                    data.label.Text="Locked: "..(remainText and remainText.Text or "??")
                    data.label.TextColor3=Color3.fromRGB(255,50,50)
                else
                    data.label.Text="Open: 0s"
                    data.label.TextColor3=Color3.fromRGB(50,255,50)
                end
            end
        end
    end
end

task.spawn(function()
    while task.wait(1) do
        if _G.BaseESP then updateBaseESP() else
            for _,v in pairs(BaseESPMap) do if v.gui then v.gui:Destroy() end end
            BaseESPMap={}
        end
    end
end)
